{% extends "base.html" %}
{% block title %}Home - Student Stay{% endblock %}
{% block content %}
<div class="container mx-auto px-4 py-8">

  <!-- Search & Filters -->
  <input id="filterInput" class="w-full px-4 py-2 border rounded-full shadow-sm mb-4" type="text" placeholder="Search location (e.g., Delhi)" />

  <div class="flex flex-wrap gap-4 items-center mb-6">
    <select id="priceSort" class="px-4 py-2 border rounded shadow-sm">
      <option value="">Sort by Price</option>
      <option value="low">Price: Low to High</option>
      <option value="high">Price: High to Low</option>
    </select>
    <select id="titleSort" class="px-4 py-2 border rounded shadow-sm">
      <option value="">Sort by Title</option>
      <option value="az">A to Z</option>
      <option value="za">Z to A</option>
    </select>
  </div>

  <!-- Tabs -->
  <div class="flex space-x-6 overflow-x-auto text-gray-700 font-semibold text-lg mb-6">
    <div class="tab active border-b-2 border-black pb-1 cursor-pointer">Rooms</div>
    <div class="tab pb-1 cursor-pointer">PGs</div>
    <div class="tab pb-1 cursor-pointer">Hostels</div>

  <!-- <a href="{{ url_for('wishlist') }}" style="display: block; text-align: right;" class="text-blue-600 hover:underline">‚ù§Ô∏è View Wishlist</a> -->
  </div>

 <div class="flex justify-end mb-4">
  <a href="{{ url_for('wishlist') }}" class="text-blue-600 hover:underline font-semibold">
    ‚ù§Ô∏è View Wishlist
  </a>
</div>

    <!-- <button type="submit" class="w-full bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700">Apply Filters</button> -->
  </form>
</div>
    </aside>

    <div class="max-w-7xl mx-auto px-4">
      <h2 class="text-3xl font-bold text-center mb-6">‚ú® Available Rooms ‚ú®</h2>
      <div id="listingContainer" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 px-4 py-6">
        {% if properties %}
          {% for room in properties %}
            <div class="room-card relative bg-white rounded-3xl shadow-xl overflow-hidden transform hover:scale-105 transition duration-300"
                 data-location="{{ room.location | lower }}"
                 data-category="{{ room.category | lower }}"
                 data-title="{{ room.title | lower }}"
                 data-price="{{ room.price }}"
                 data-lat="{{ room.latitude }}"
                 data-lng="{{ room.longitude }}"
                 data-index="{{ loop.index }}">

              <form action="{{ url_for('add_to_wishlist', room_id=room.id) }}" method="POST" class="absolute top-2 right-2 z-10">
  <button type="submit" class="text-2xl" title="Add to Wishlist">
    {% if room.id in wishlist_ids %}
      <span class="text-red-500">‚ù§Ô∏è</span>
    {% else %}
      <span class="text-gray-400 hover:text-red-500">‚ô°</span>
    {% endif %}
  </button>
</form>


<div class="w-full h-48 overflow-x-auto whitespace-nowrap">
  {% if room.photos and room.photos|length > 0 %}
    {% for photo in room.photos %}
      <img class="inline-block h-48 w-auto object-cover mr-2 rounded"
           src="{{ url_for('static', filename='uploads/' ~ photo.filename) }}"
           alt="Photo of {{ room.title }}">
    {% endfor %}
  {% elif room.photo_filename %}
    <img class="h-48 w-full object-cover rounded"
         src="{{ url_for('static', filename='uploads/' ~ room.photo_filename) }}"
         alt="{{ room.title }}">
  {% else %}
    <div class="bg-gray-200 w-full h-48 flex items-center justify-center text-gray-500">
      No photo available
    </div>
  {% endif %}
</div>




              <div class="p-6">
                <h3 class="text-xl font-bold mb-2">{{ room.title }}</h3>
                <p class="mb-4 text-sm">{{ room.description }}</p>
                <p class="text-sm"><strong>üìç Location:</strong> {{ room.location }}</p>
                <p class="text-sm"><strong>üí∞ Price:</strong> ‚Çπ{{ room.price }}</p>

                {% if room.latitude and room.longitude %}
                  <div id="map{{ loop.index }}" class="w-full h-48 mt-4 rounded-lg shadow-sm"></div>
                {% endif %}

               <div class="mt-4 flex justify-center">
  <a href="{{ url_for('book_property', room_id=room.id) }}"
     class="inline-block bg-yellow-500 text-white px-4 py-2 rounded-full shadow hover:bg-yellow-600 transition">
    Book Now
  </a>
</div>

              </div>
            </div>
          {% endfor %}
        {% else %}
          <p class="text-center text-lg">No rooms available right now. Please check back later.</p>
        {% endif %}
      </div>
    </div>
  </div>
</div>



<!-- Google Maps Init Script -->
<script>
  function initMap() {
    console.log("Google Maps loaded!");

    document.querySelectorAll(".room-card").forEach(card => {
      const lat = parseFloat(card.dataset.lat);
      const lng = parseFloat(card.dataset.lng);
      const index = card.dataset.index;

      if (!isNaN(lat) && !isNaN(lng)) {
        const mapDiv = document.getElementById("map" + index);
        const map = new google.maps.Map(mapDiv, {
          center: { lat: lat, lng: lng },
          zoom: 14
        });

        const marker = new google.maps.Marker({
          position: { lat: lat, lng: lng },
          map: map
        });

        // üëá Add click listener to redirect to Google Maps
        marker.addListener('click', function () {
          const mapsUrl = `https://www.google.com/maps?q=${lat},${lng}`;
          window.open(mapsUrl, '_blank');
        });
      }
    });
  }
</script>

<script async defer
    src="https://maps.googleapis.com/maps/api/js?key={{ google_maps_api_key }}&callback=initMap">

</script>

<!-- Your Custom js  -->
 <script>
  //  const filterInput = document.getElementById("filterInput");
  // const allCards = document.querySelectorAll(".room-card");

  // function filterListings() {
  //   const value = filterInput.value.toLowerCase();
  //   const minPrice = parseInt(document.getElementById("minPrice").value) || 0;
  //   const maxPrice = parseInt(document.getElementById("maxPrice").value) || Infinity;
  //   const hasPhoto = document.getElementById("hasPhoto").checked;

  //   allCards.forEach(card => {
  //     const location = card.dataset.location;
  //     const price = parseInt(card.dataset.price);
  //     const hasImage = card.querySelector("img") !== null;

  //     const matchesSearch = location.includes(value);
  //     const matchesPrice = price >= minPrice && price <= maxPrice;
  //     const matchesPhoto = !hasPhoto || hasImage;

  //     card.style.display = (matchesSearch && matchesPrice && matchesPhoto) ? "block" : "none";
  //   });
  // }

  // filterInput.addEventListener("input", filterListings);
  // document.getElementById("minPrice").addEventListener("input", filterListings);
  // document.getElementById("maxPrice").addEventListener("input", filterListings);
  // document.getElementById("hasPhoto").addEventListener("change", filterListings);

  // document.querySelectorAll(".tab").forEach(tab => {
  //   tab.addEventListener("click", () => {
  //     const category = tab.textContent.toLowerCase();
  //     allCards.forEach(card => {
  //       card.style.display = (category === "rooms" || card.dataset.category === category) ? "block" : "none";
  //     });
  //     document.querySelectorAll(".tab").forEach(t => t.classList.remove("border-b-2", "border-black"));
  //     tab.classList.add("border-b-2", "border-black");
  //   });
  // }); 

  
   function toggleFilter() {
   const panel = document.getElementById("filterPanel");
    panel.classList.toggle("-translate-x-full");
   } 



  document.getElementById("priceSort").addEventListener("change", function () {
    const direction = this.value;
    const container = document.getElementById("listingContainer");
    const cards = Array.from(container.children);
    cards.sort((a, b) => {
      const priceA = parseInt(a.dataset.price);
      const priceB = parseInt(b.dataset.price);
      return direction === "low" ? priceA - priceB : priceB - priceA;
    });
    container.innerHTML = "";
    cards.forEach(card => container.appendChild(card));
  });

  document.getElementById("titleSort").addEventListener("change", function () {
    const direction = this.value;
    const container = document.getElementById("listingContainer");
    const cards = Array.from(container.children);
    cards.sort((a, b) => {
      const titleA = a.dataset.title;
      const titleB = b.dataset.title;
      return direction === "az" ? titleA.localeCompare(titleB) : titleB.localeCompare(titleA);
    });
    container.innerHTML = "";
    cards.forEach(card => container.appendChild(card));
  });

  document.querySelectorAll(".heart").forEach(heart => {
    heart.addEventListener("click", () => {
      heart.textContent = heart.textContent === "‚ô°" ? "‚ù§Ô∏è" : "‚ô°";
    });
  });
</script>




{% endblock %}
